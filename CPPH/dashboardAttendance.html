<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Attendance with Charts</title>
    <link rel="stylesheet" href="dashboardAttendance.css">
    <!-- Include PapaParse -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <!-- Include Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        /* Flexbox layout to display charts side by side */
        .charts {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        /* Style for each chart */
        .chart-container {
            width: 48%; /* 2 charts will take up 48% of the width each */
            height: 400px;
        }
    </style>
</head>
<body>
    <!-- Header with logo and name -->
    <header>
        <picture>
            <img class="logo" src="logo.jpg" alt="Calcomp Logo">
            <img class="name" src="name.jpg" alt="Calcomp Name">
        </picture>
    </header>

    <!-- Main content container -->
    <main class="container">
        <nav id="sidebar" class="sidebar">
            <!-- dashboard -->
            <ul>
                <li onclick="dashboardDropdown()">
                    <span class="line-md--text-box1"></span>
                    <h3>Dashboard </h3>
                    <span id="arrow" class="line-md--arrow-left"></span> 
                </li>
                <ul id="dashboardDropdown">
                  <li><a href="dashboardDailyTransfer.html">Daily Transfer</a></li>
                  <li><a href="dashboardOutput.html">Output Monitoring</a></li>
                  <li><a href="dashboardStatus.html">Overall Status</a></li>
                  <li><a href="dashboardPrinting.html">Printing</a></li>
                  <li><a href="dashboardAttendance.html">Attendance</a></li>
                </ul>
            </ul>
            <!-- daily transfer -->
            <ul>
                <a href="dailyTransfer.html"><li> 
                    <span class="line-md--arrows-horizontal1"></span>
                    <h3>Daily Transfer </h3>
                    <span id="arrow" class="line-md--arrow-left"></span> 
                </li>
              </a>
            </ul>
            <!-- Tooling -->
            <ul>
                <li onclick="toolingDropdown()"> 
                    <span class="line-md--cog-loop1"></span>
                    <h3>Tooling </h3>
                    <span id="arrow" class="line-md--arrow-left"></span> 
                </li>
                <ul id="toolingDropdown">
                  <li><a href="registration.html">Registration List</a></li>
                  <li><a href="toolingList.html">Tooling List</a></li>
                  <li><a href="detailedSchedule.html">Detailed Schedule</a></li>
                </ul>
            </ul>
            <!-- Running status -->
            <ul>
                <a href="runningStatus.html"><li> 
                    <span class="line-md--speedometer-loop1"></span>
                    <h3>Running Status </h3>
                    <span id="arrow" class="line-md--arrow-left" style="visibility: hidden;"></span> 
                </li>
              </a>
            </ul>
            <!-- Printing -->
            <ul>
                <a href="printing.html"><li> 
                    <span class="line-md--cloud-alt-print-loop1"></span>
                    <h3>Printing </h3>
                    <span id="arrow" class="line-md--arrow-left" style="visibility: hidden;"></span> 
                </li>
              </a>
            </ul>
            <!-- Molding -->
            <ul>
                <a href="molding.html"><li> 
                    <span class="line-md--engine1"></span>
                    <h3>Molding </h3> 
                    <span id="arrow" class="line-md--arrow-left" style="visibility: hidden;"></span> 
                </li>
              </a>
            </ul>
          
            <!-- attendance -->
            <ul>
                <a href="attendance.html"><li> 
                    <span class="line-md--account1"></span>
                    <h3>Attendance </h3>
                    <span id="arrow" class="line-md--arrow-left" style="visibility: hidden;"></span> 
                  
                </li>
              </a>
            </ul>
            <!-- logout -->
            <ul>
                <a href="homepage.html"><li> 
                    <span class="line-md--log-out"></span>
                    <h3>Logout </h3>
                </li>
              </a>
            </ul>
        </nav>

    
        <article id="attendance">
            <p>Dashboard Attendance</p>
            <!-- File input for CSV upload -->
            <input type="file" id="fileInput" />
            <!-- Div to display the charts -->
            <div class="charts">
                <div class="chart-container" id="donut_chart"></div>
                <div class="chart-container" id="bar_chart"></div>
            </div>
        </article>
    </main>

    <!-- Chart rendering script -->
 <script type="text/javascript">
        // Load Google Charts
        google.charts.load('current', { packages: ['corechart', 'bar'] });

        // Set callback to run when Google Charts is loaded
        google.charts.setOnLoadCallback(function() {
            document.getElementById("fileInput").addEventListener("change", function(e) {
                const file = e.target.files[0];
                if (file) {
                    // Parse the CSV file
                    Papa.parse(file, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(result) {
                            console.log("Parsed Data:", result.data); // Log parsed data

                            // Generate Donut Chart (Attendance by Shift)
                            generateDonutChart(result.data);
                            // Generate Bar Chart (Number of Members per Department)
                            generateBarChart(result.data);
                        },
                        error: function(error) {
                            console.error("Error parsing CSV:", error.message);
                        }
                    });
                }
            });
        });

        // Function to generate Donut Chart (Attendance by Shift)
function generateDonutChart(data) {
            // Count attendance by shift (Example: 'Day' or 'Night')
            const shiftCounts = { Day: 0, Night: 0 };
            data.forEach(row => {
                // Adjust according to how your shift data is represented in your CSV
                if (row['Shift'] === 'D') {
                    shiftCounts.Day++;
                } else if (row['Shift'] === 'N') {
                    shiftCounts.Night++;
                }
            });

            // Prepare data for the donut chart
            const donutData = google.visualization.arrayToDataTable([
                ['Shift', 'Headcount'],
                ['Day Shift', shiftCounts.Day],
                ['Night Shift', shiftCounts.Night]
            ]);

            // Set chart options for donut chart
            const donutOptions = {
                title: 'Headcount by Shift',
                pieHole: 0.4,
                colors: ['#FFD700', '#191970'],
                legend: { position: 'bottom' },
                backgroundColor: { fill: 'transparent' },
                titleTextStyle: {
                position:'center',
                color: '#EAEAEA', // Set title text color to dirty white
                fontSize: 20, // Set title font size
                fontWeight: 'bold', // Set title font weight to bold
                fontName: 'Arial' // Set title font family (optional)
            },
            legend: {
                position: 'bottom',
                textStyle: {
                    color: '#EAEAEA', // Set legend text color to dirty white
                    fontSize: 14, // Set legend font size
                    fontWeight: 'bold', // Set legend font weight to bold
                    fontName: 'Arial' // Set legend font family (optional)
                }
            },
            titlePosition: 'justify' 
            };

            // Create and draw the donut chart
            const donutChart = new google.visualization.PieChart(document.getElementById('donut_chart'));
            donutChart.draw(donutData, donutOptions);
        }
        function generateBarChart(data) {
    // Count the number of members per department
    const departmentCounts = {};
    data.forEach(row => {
        const department = row['Dept Name'];
        if (department) {
            departmentCounts[department] = (departmentCounts[department] || 0) + 1;
        }
    });

    // Prepare data for the stacked bar chart
    const barData = [['Department', 'Member Count']];
    Object.entries(departmentCounts).forEach(([department, count]) => {
        barData.push([department, count]);
    });

    // Convert data into a format Google Charts understands
    const googleBarData = google.visualization.arrayToDataTable(barData);

    // Set options for the stacked column chart (which is vertically stacked)
    const barOptions = {
        title: 'Number of Members per Department',
        isStacked: true,  // Enables stacked bars
        vAxis: { title: 'Number of Members' }, // Vertical axis now represents 'Number of Members'
        hAxis: { title: 'Department' },        // Horizontal axis now represents 'Department'
        colors: ['#1b9e77'],  // Can add more colors for multiple stacks if needed
        chartArea: { width: '80%' }, // Optional: Adjust legend position if you have multiple categories
        backgroundColor: { fill: 'transparent' },
        titleTextStyle: {
                position:'center',
                color: '#EAEAEA', // Set title text color to dirty white
                fontSize: 20, // Set title font size
                fontWeight: 'bold', // Set title font weight to bold
                fontName: 'Arial' // Set title font family (optional)
        },
        legend: {
                position: 'bottom',
                textStyle: {
                    color: '#EAEAEA', // Set legend text color to dirty white
                    fontSize: 14, // Set legend font size
                    fontWeight: 'bold', // Set legend font weight to bold
                    fontName: 'Arial' // Set legend font family (optional)
                }
            },
    };

    // Create and draw the stacked column chart
    const barChart = new google.visualization.ColumnChart(document.getElementById('bar_chart'));
    barChart.draw(googleBarData, barOptions);
}



    </script>
</body>
</html>
